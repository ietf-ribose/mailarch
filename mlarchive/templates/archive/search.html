{% extends 'base.html' %}

{% load archive_extras %}

{% block extrahead %}
<script type="text/javascript" src="{{ STATIC_URL }}js/jquery.query.js"></script>
<script type="text/javascript" src="{{ STATIC_URL }}js/search.js"></script>
{% endblock %}

{% block title %}Mail Archive{% endblock %}

{% block content %}

    <!-- use context "form" to re-display search form -->
  
    <div id="msg-headers">         
        <div id="search-header">
          {% include "includes/search_box.html" %}
        </div> <!-- search-header -->        
    </div> <!-- msg-headers -->
        
    <div id="msg-container">
        <div id="sidebar">
            <div id="search-filters">
                <h4>FILTER BY TIME</h4>
                <ul class="filter-options" tabindex="-1">
                  <li class="filter-item"><a class="{% selected request 'qdr' '' %}" href="{% append_to_get qdr='' %}">Anytime</a></li>
                  <li class="filter-item"><a class="{% selected request 'qdr' 'd' %}" href="{% append_to_get qdr='d' %}">Past day</a></li>
                  <li class="filter-item"><a class="{% selected request 'qdr' 'w' %}" href="{% append_to_get qdr='w' %}">Past week</a></li>
                  <li class="filter-item"><a class="{% selected request 'qdr' 'm' %}" href="{% append_to_get qdr='m' %}">Past month</a></li>
                  <li class="filter-item"><a class="{% selected request 'qdr' 'y' %}" href="{% append_to_get qdr='y' %}">Past year</a></li>
                </ul>
                <h4>FILTER BY LIST</h4>
                <ul class="filter-options" tabindex="-1">
                {% if base_facets.fields.email_list %}
                    <form id="list-filter">
                    {% for list in base_facets.fields.email_list|slice:":6" %}
                        <li><input class="list-facet facetchk" type="checkbox" name="f_list" value="{{ list.0 }}" {% checked request 'f_list' list.0 %}>{{ list.0 }} ({{ list.1 }})</li>
                    {% endfor %}
                    {% if base_facets.fields.email_list|length > 6 %}
                        <li><a class="more-link" href="">more...</a></li>
                        <div id="list-filter-extra" class="filter-extra-div" tabindex="-1">
                        {% for list in base_facets.fields.email_list|slice:"6:" %}
                            <li class="filter-extra"><input class="list-facet facetchk" type="checkbox" name="f_list" value="{{ list.0 }}" {% checked request 'f_list' list.0 %}>{{ list.0 }} ({{ list.1 }})</li>
                        {% endfor %}
                        </div>
                    {% endif %}
                    <li><a id="list-filter-clear" href="">Clear</a></li>
                    </form>
                {% endif %}
                </ul>
                <h4>FILTER BY FROM</h4>
                <ul class="filter-options" tabindex="-1">
                 {% if base_facets.fields.frm_email %}
                    <form id="from-filter">
                    {% for email in base_facets.fields.frm_email|slice:":6" %}
                        <li><input class="from-facet facetchk" type="checkbox" name="f_from" value="{{ email.0 }}" {% checked request 'f_from' email.0 %}>{{ email.0|truncatechars:18 }} ({{ email.1 }})</li>
                    {% endfor %}
                    {% if base_facets.fields.frm_email|length > 6 %}
                        <li><a class="more-link" href="">more...</a></li>
                        <div id="from-filter-extra" class="filter-extra-div" tabindex="-1">
                        {% for email in base_facets.fields.frm_email|slice:"6:" %}
                            <li class="filter-extra"><input class="from-facet facetchk" type="checkbox" name="f_from" value="{{ email.0 }}" {% checked request 'f_from' email.0 %}>{{ email.0|truncatechars:18 }} ({{ email.1 }})</li>
                        {% endfor %}
                        </div>
                    {% endif %}
                    <li><a id="from-filter-clear" href="">Clear</a></li>
                    </form>
                {% endif %}
                </ul>
            </div> <!-- search-filters -->
        </div> <!-- msg-left-nav -->
        
        <div id="msg-panes">    
            <div id="list-pane">
                <div id="msg-list-header">
                    <table id="msg-list-header-table">
                        <thead>
                            <tr>
                                <th><a id="sort-button-date" class="unsorted sortbutton" href="#">Date</a></th>
                                <th><a id="sort-button-subject" class="unsorted sortbutton" href="#">Subject</a></th>
                                <th><a id="sort-button-frm" class="unsorted sortbutton" href="#">From</a></th>
                                <th><a id="sort-button-email_list" class="unsorted sortbutton" href="#">List</a></th>
                                <th><a id="sort-button-score" class="unsorted sortbutton" href="#">Score</a></th>
                            </tr>
                        </thead>
                    </table>
                </div>
                <div id="msg-list" tabindex="-1">
                    <table id="msg-table" class="no-zebra">
                    {% for result in page.object_list %}
                        <tr>
                            <td>{{ result.object.date|date:"m/d/Y" }}</td>
                            {# <td><a href="{% url archive_detail id=result.object.hashcode %}">{{ result.object.subject }}</a></td> #}
                            <td class="nowrap">{{ result.object.subject|truncatechars:70 }}</td>
                            <td>{{ result.object.friendly_frm|truncatechars:35 }}</td>
                            <td>{{ result.object.email_list }}</td>
                            <td>{{ result.score }}</td>
                            <td class="hidden">{{ result.object.id }}</td>
                        </tr>
                    {% empty %}
                        <tr><td>No results found</td><tr>
                    {% endfor %}
                    </table>
                </div> <!-- msg-list -->
                
                <div id="msg-list-controls">
                    {# Showing {{ page.object_list|length }} of {{ page.paginator.count }} #}
                    {{ page.paginator.count }} Messages
        
                    {% if page.has_previous or page.has_next %}
                        <span class="right">
                            {{ page|cut:"<"|cut:">" }}&nbsp;
                            {% if page.has_previous %}<a class="msg-link" href="{% append_to_get page=page.previous_page_number %}">{% endif %}&laquo; Previous{% if page.has_previous %}</a>{% endif %}
                            |
                            {% if page.has_next %}<a class="msg-link" href="{% append_to_get page=page.next_page_number %}">{% endif %}Next &raquo;{% if page.has_next %}</a>{% endif %}
                        </span>
                    {% endif %}
                </div> <!-- msg-list-controls -->
            </div> <!-- list-pane -->
            <div id="splitter-pane" class="draggable"></div>
            <div id="view-pane"></div>
        </div> <!-- msg-panes -->
    </div> <!-- msg-container -->
{% endblock %}
