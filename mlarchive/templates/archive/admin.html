{% extends "base.html" %}
{% load static bootstrap3 widget_tweaks %}

{% block extrastyle %}
<link rel="stylesheet" href="{% static 'selectize/css/selectize.bootstrap3.css' %}" type="text/css">
<link rel="stylesheet" href="{% static 'bootstrap-datepicker/css/bootstrap-datepicker.min.css' %}" type="text/css">
{% endblock %}

{% block title %}Mail Archive - Admin{% endblock %}

{% block header %}{{ block.super }} - Admin{% endblock %}

{% block content %}

<div id="admin-page">
    <div id="admin-top">
        <div id="admin-view-pane" class="hidden"></div>
        <div id="admin_search_form">
            <form id="id_admin_form" name="admin-search-form" class="form-inline" action="." method="get">
                <div class="row">
                    <div class="col-md-4 col-md-offset-2">
                        {% render_field form.subject class="form-control" placeholder="Subject" %}
                    </div>
                    <div class="col-md-4">
                        {% render_field form.msgid class="form-control" placeholder="Message-Id" %}
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-4 col-md-offset-2">
                        {% render_field form.frm class="form-control" placeholder="From" %}
                    </div>
                    <div class="col-md-4">
                        {% render_field form.email_list class="form-control" placeholder="Email List" %}
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-4 col-md-offset-2">
                        <div class="subrow">
                        <div class="col-md-6 subrow-left">
                          {% render_field form.start_date class="form-control" placeholder="Start Date" %}
                        </div>
                        <div class="col-md-6 subrow-right">
                            {% render_field form.end_date class="form-control" placeholder="End Date" %}
                        </div>
                        </div>
                    </div>
                    <div class="col-md-2">
                        <button class="btn btn-default" type="submit">Search</button>
                    </div>
                    <div class="col-md-2">
                        <label class="checkbox-inline"><input type="checkbox" name="exclude_whitelisted_senders" value="exclude_whitelisted_senders">Exclude Whitelisted Senders</label>
                    </div>
                </div>
            </form>
        </div> <!-- admin_search_form -->
    </div> <!-- admin-top -->

    <div id="result-list" class="section" tabindex="-1">
        <h3>Results{% if results %} ({{ results|length }}){% endif %}</h3>
        <form id="id_admin_action" class="form-inline" name="admin-action-form" action="." method="post">{% csrf_token %}

        <div class="row">
            <div class="col-md-1 col-md-offset-1">
                <label class="checkbox-inline"><input type="checkbox" id="selectall" name="selectall" value="selectall">Select All</label>
            </div>
            <div class="col-md-4">
                <label class="sr-only" for="action-select">Action</label>
                {{ action_form.action.errors }}
                <select id="action-select" name="action" class="form-control" placeholder="Select action">
                    <option value="" selected="selected" disabled>Select Action</option>
                    <option value="remove_selected">Remove selected messages</option>
                    <option value="not_spam">Mark selected not spam</option>
                </select>
                <input type="hidden" class="select-across" value="0" name="select_across" />
                <button type="submit" class="btn btn-default" title="Run the selected action" name="index" value="0">Go</button>
            </div>
            <div class="col-md-3">
                <div class="btn-group" role="group" aria-label="spam buttons">
                    <button id="spam-toggle" type="button" class="btn btn-primary" data-toggle="button" aria-pressed="false" autocomplete="off">Spam Mode</button>
                    <button id="spam-process" type="button" class="btn btn-primary disabled" data-toggle="button" aria-pressed="false" autocomplete="off">Process Spam</button>
                    <span class="spinner hidden"><i class="fa fa-refresh fa-spin" style="font-size:24px"></i></span>
                </div>
            </div>
            <div class="col-md-3">
                <div class="checkbox-inline hidden">
                    <label class="checkbox-inline"><input type="checkbox" id="move-subject" value="" checked>Move identical subject</label>
                </div>
                
            </div>
        </div> <!-- row -->

        <ul class="nav nav-tabs hidden">
          <div class="alert alert-warning" role="alert">Use left and right arrow keys to sort messages.  Right = spam, Left = not spam.  Use Process Spam button to remove spam and mark clean messages.</div>
          <li role="presentation"><a data-toggle="tab" href="#clean-pane">Clean - 0</a></li>
          <li role="presentation" class="active"><a data-toggle="tab" href="#search-pane">Search - {{ results|length }}</a></li>
          <li role="presentation"><a data-toggle="tab" href="#spam-pane">Spam - 0</a></li>
        </ul>

        <div class="tab-content" tabindex="0">
            <div id="clean-pane" class="tab-pane">
                {% include "includes/admin_results.html" %}
            </div>
            <div id="search-pane" class="tab-pane active">
                {% with admin_results=results %}
                    {% include "includes/admin_results.html" %}
                {% endwith %}
            </div>
            <div id="spam-pane" class="tab-pane">
                {% include "includes/admin_results.html" %}
            </div>
        </div> <!-- tab-content -->
        
        </form>
</div> <!-- result-list -->
</div> <!-- admin-page -->

{% endblock %}

{% block modal %}
<div id="spam-modal" class="modal fade" role="dialog">
  <div class="modal-dialog">

    <!-- Modal content-->
    <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal">&times;</button>
          <h4 class="modal-title">Spam</h4>
        </div>
        <div class="modal-body">
          <p>Move all messages with the same subject to spam?</p>
        </div>
        <div class="modal-footer">
          <button id="yes-move" type="button" class="btn btn-default">Yes</button>
          <button id="no-move" type="button" class="btn btn-default">No</button>
        </div>
    </div>

  </div>
</div>
{% endblock %}

{% block js %}
<script type="text/javascript" src="{% static 'bootstrap-datepicker/js/bootstrap-datepicker.min.js' %}"></script>
<script type="text/javascript" src="{% static 'selectize/js/standalone/selectize.min.js' %}"></script>
<script type="text/javascript" src="{% static 'jquery.cookie/jquery.cookie.js' %}"></script>
<script type="text/javascript" src="{% static 'mlarchive/js/admin.js' %}"></script>
{% endblock %}

